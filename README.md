---

## 🔍 各フォルダの概要

| フォルダ名             | 内容 |
|------------------------|------|
| `00_ASM/`              | ASM法で計算されたホログラム画像とオブジェクト画像 |
| `00_Mie/`              | Mie散乱結果のデータと可視化画像（PNG, SVG） |
| `99_codes_for_ASM/`    | Fresnel伝搬や画像生成のPythonスクリプト |
| `99_codes_for_Mie/`    | ローレンツ–Mie理論に基づく散乱場評価コード（Python, Julia） |

---

## 📁 ディレクトリ構成
nearfield-mie/
├── 00_ASM/ # Fresnel近似でのホログラム画像（Obj, Holo）
├── 00_Mie/ # Mie散乱結果の画像とデータファイル
│ ├── data/ # 強度データファイル（.dat）
│ ├── figs/ # 散乱画像（contour, heatmap, smooth）
│ └── images/ # 整形済み画像素材など
├── 99_codes_for_ASM/ # ASM用Pythonコード（シミュレーション＋描画）
├── 99_codes_for_Mie/ # Mie散乱コード（Python/Julia）
│ ├── 01_Mie.py # 任意精度版（mpmath使用のため，実行にかなり時間がかかる）
│ ├── Mie_data.jl # Julia版（高精度）
│ ├── Mie_scipy.py # SciPy版（透過粒子向け）
│ ├── 02_graph_for_MIE.py # データ可視化
│ └── Mie_data.jl # Julia実装版（重複なら整理してもOK）
└── README.md # このファイル

### `00_ASM.py`

このスクリプトは、円形粒子による回折パターンをFresnel近似でシミュレーションし、  
ホログラム画像として保存するプログラムです。  

**主な処理内容：**
- オブジェクト画像の生成（粒子の影）
- Fresnel伝搬の計算（FFTベース）
- 出力画像・強度マップの保存（PNG・DAT形式）

**出力：**
- 再構成画像：`00_ASM/Holo1.png`
- 元画像（オブジェクト）：`00_ASM/Obj.png`
- 強度マップデータ：`00_record/data/*.dat`

※ 可視化関数（等高線・ヒートマップ）はデフォルトではコメントアウトされています。

### `01_graph_for_ASM.py`

このスクリプトは、`00_ASM.py` によって出力された `.dat` ファイル（Fresnel強度分布）を読み込み、以下の3種類の図として保存します：

- 等高線プロット（contour）
- ピクセルベースヒートマップ（nearest）
- 補間付きヒートマップ（bicubic）

**出力先：** `00_ASM/figs/`

> 💡 論文・発表資料にそのまま使えるよう、フォントは Times New Roman + Computer Modern に設定されています。
> フォントパスは環境に応じて調整してください。


### `01_Mie.py`

このスクリプトは、近接場Lorenz-Mie理論に基づいて、球状粒子による散乱電磁場と放射強度分布を計算します。

- Bessel関数やLegendre多項式を用いたMie係数 \( a_n, b_n \) を算出
- 電磁場成分 \( E_r, E_\theta, E_\phi, H_r, H_\theta, H_\phi \) を構成
- 放射強度 \( S(r, \theta, \phi) \) を評価し、2次元マップとして出力

**出力：**
- 強度分布データ（x, y, S）：`00_Mie/data/*.dat`
- （任意）放射強度ヒートマップ・等高線図：`00_Mie/figs/*.svg`

> ⚠️ 本スクリプトでは任意精度計算のため、`mpmath` を使用しています。
> 大きなグリッドでは実行時間が長くなる可能性があるため、分解能・範囲は適宜調整してください。


### `02_graph_for_MIE.py`

このスクリプトは、`01_Mie.py` によって出力された `.dat` ファイル（Mie散乱に基づく放射強度分布）を読み込み、以下の図を生成します：

- 等高線プロット（contour）
- ピクセルベースヒートマップ（nearest）
- 補間付きヒートマップ（bicubic）

**出力先：** `00_Mie/figs/`

> ⚠️ 論文や発表スライドでの利用を想定して、Times New Roman + Computer Modern のフォント指定が含まれています。環境によってはパスを調整してください。


### `Mie_data.jl`

Julia言語によるLorenz-Mie散乱解析コードです。Python版に比べて高精度な数値演算が可能で、特にベッセル関数やLegendre多項式の扱いに強みがあります。

- 複素数対応の aₙ, bₙ 係数（Eq. 12, 13）
- 散乱電磁場ベクトル E, H の6成分（Eq. 33〜38）
- 放射強度 S の計算（Eq. 40）
- 極座標変換・グリッド全体で評価・.dat保存

**出力：**
- 強度マップ（x, y, S）：`../data/mie_isophote.dat`

> 💡 `Plots.jl` による等高線描画も可能（現在はコメントアウト）。必要に応じて有効化してください。


### `Mie_scipy.py`

SciPyベースでローレンツ–Mie理論を実装し、透明球状粒子に対する近接場放射強度 \( S(r, \theta, \phi) \) を評価するスクリプトです。

- 式(9)〜(40) に基づくベッセル関数、Mie係数、電磁場成分、ポインティングベクトルを実装
- z=10μm 平面上の 60×60 グリッドに対して、放射強度を数値評価
- 出力は等高線図（SVG）

> 💡 透明粒子を想定した設定で、グラフは `Fig.3` として論文中の図に対応
> 実行には `scipy`, `matplotlib`, `tqdm` などが必要です


## 技術的な補足（数値精度と実装上の課題）

- SciPyによるローレンツ–Mie理論の実装では、粒子サイズが大きく屈折率に虚部がある（不透過粒子）場合において、
  **球ベッセル関数の桁あふれ**（オーバーフロー）が発生。
- この問題を解決するために、以下の代替実装を行った：
  - Julia (`Mie_data.jl`): 高精度 Bessel 関数と Legendre 多項式を使用
  - Python (`mpmath`): 任意精度演算による安定した評価
- これにより、n=1〜50以上の高次モードを含む正確な放射強度分布の計算が可能に。

